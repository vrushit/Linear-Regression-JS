from flask import Flask
from flask import send_file, request
import matplotlib.pyplot as plt
import io

app = Flask(__name__)

@app.route('/plot', methods=['POST'])
def build_plot():
    img = io.BytesIO()

    data = request.get_json()
    x = data.get('x')
    y = data.get('y')
    xLabel = data.get('xLabel') or ''
    yLabel = data.get('yLabel') or ''
    title = data.get('title') or ''

    plt.xlabel(xLabel)
    plt.ylabel(yLabel)
    plt.title(title)
    
    if y is None:
      plt.plot(x)
    else:
      plt.scatter(x,y)

    plt.savefig(img, format='png')
    plt.close()
    img.seek(0)

    return send_file(img,
                     attachment_filename='chart.png',
                     mimetype='image/png')

if __name__ == '__main__':
    app.debug = True
    app.run(host='0.0.0.0', port=80)